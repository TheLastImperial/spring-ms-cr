apiVersion: v1
kind: ConfigMap
metadata:
  name: user-db-config
data:
  DB_NAME: user
  DB_USER: user
  DB_PORT: "5432"
  initdb.sql: |
    CREATE TABLE public.roles (
        id bigint NOT NULL,
        name character varying(255)
    );
    ALTER TABLE public.roles OWNER TO "user";
    CREATE SEQUENCE public.roles_seq
        START WITH 1
        INCREMENT BY 50
        NO MINVALUE
        NO MAXVALUE
        CACHE 1;
    ALTER SEQUENCE public.roles_seq OWNER TO "user";
    CREATE TABLE public.users (
        id bigint NOT NULL,
        email character varying(255),
        name character varying(255),
        password character varying(255)
    );
    ALTER TABLE public.users OWNER TO "user";
    ALTER TABLE public.users ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
        SEQUENCE NAME public.users_id_seq
        START WITH 1
        INCREMENT BY 1
        NO MINVALUE
        NO MAXVALUE
        CACHE 1
    );
    CREATE TABLE public.users_roles (
        users_id bigint NOT NULL,
        roles_id bigint NOT NULL
    );
    ALTER TABLE public.users_roles OWNER TO "user";
    ALTER TABLE ONLY public.roles
        ADD CONSTRAINT roles_pkey PRIMARY KEY (id);
    ALTER TABLE ONLY public.users
        ADD CONSTRAINT uk6dotkott2kjsp8vw4d0m25fb7 UNIQUE (email);
    ALTER TABLE ONLY public.users
        ADD CONSTRAINT users_pkey PRIMARY KEY (id);
    ALTER TABLE ONLY public.users_roles
        ADD CONSTRAINT fka62j07k5mhgifpp955h37ponj FOREIGN KEY (roles_id) REFERENCES public.roles(id);
    ALTER TABLE ONLY public.users_roles
        ADD CONSTRAINT fkml90kef4w2jy7oxyqv742tsfc FOREIGN KEY (users_id) REFERENCES public.users(id);
    INSERT INTO roles(id, name) VALUES
    (1, 'ROLE_ROOT'),
    (2, 'ROLE_ADMIN'),
    (3, 'ROLE_USER');

